<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:h="http://java.sun.com/jsf/html">

<h:head>
	<title>PrimeFaces Test</title>
</h:head>
<h:body>

	<h:form>
		<p:growl id="growl" showDetail="true" sticky="true" />  
		<p:panel header="Form" id="panel">
			<h:panelGrid columns="2" cellpadding="10">
				<h:outputText value="Name" />
				
				<p:inputText value="#{testView.info.name}" readonly="#{applicationSocket.readOnly}"></p:inputText>
				
				<!-- readonly="#{testView.info.readOnly}" -->
				
				<h:outputText value="Description" />
				
				<p:inputTextarea value="#{testView.info.description}" readonly="#{applicationSocket.readOnly}"></p:inputTextarea>
				
				<!-- readonly="#{testView.info.readOnly}" -->
			</h:panelGrid>
			
			<p:commandButton value="Edit" 
							icon="fa fa-edit" 
							update="@form"
							rendered="#{testView.info.readOnly}"
							actionListener="#{testView.editButtonAction()}">
							
			</p:commandButton>
			
			<p:commandButton widgetVar="save" value="Save" icon="fa fa-save" rendered="#{!applicationSocket.readOnly}"></p:commandButton>
			
			<!-- rendered="#{!testView.info.readOnly}" -->
			
			<p:commandButton widgetVar="cancel" value="Cancel" rendered="#{!applicationSocket.readOnly}" icon="fa fa-times">
			
			<!-- rendered="#{!testView.info.readOnly}" -->
			
			</p:commandButton>
			
			<!-- <p:commandButton widgetVar="asyncCommand" value="submit"
        		action="#{someTaskBacking.start}" onclick="start()" /> -->
        		
        	<p:commandButton actionListener="#{applicationSocket.turnOnEditMode()}" update="@form"></p:commandButton>
		</p:panel>
	
		<!-- <o:socket onmessage="commandScriptName" channel="secondChannel" ></o:socket>
		<o:commandScript name="commandScriptName" actionListener="" render="@form" /> -->
		
		<o:socket channel="secondChannel"
				onmessage="onMessage"
			>
		</o:socket>
		
		<o:commandScript name="pushCommandScript" render="panel"></o:commandScript>
			<!-- onmessage="function(m){console.log(m);}" --> 
	<p:remoteCommand name="rc" actionListener="#{testView.onEdit()}" update="@form"></p:remoteCommand>
	</h:form>
	
	<o:socket onmessage="asyncListener" channel="async" scope="view" connected="false"></o:socket>
	
	
	<script>
		function onMessage(msg) {
			console.log(msg);
			//alert(msg);
			rc();
		}
		
		function start() {
			console.log("start");
			OmniFaces.Push.open("async");
		}

		function pushSecondChannel() {
			console.log("second channel");
			OmniFaces.Push.open("secondChannel");
		}

		function asyncListener(result) {
		    OmniFaces.Push.close("async");
		    console.log(result); // Do your thing with HTML DOM.
		    PF("asyncCommand").enable();
		}
	</script>
</h:body>
</html>