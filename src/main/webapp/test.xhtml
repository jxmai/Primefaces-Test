<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:h="http://java.sun.com/jsf/html">

<h:head>
	<title>PrimeFaces Test</title>
</h:head>
<h:body>
	<!-- https://stackoverflow.com/questions/3787514/how-can-server-push-asynchronous-changes-to-a-html-page-created-by-jsf -->
	<h:form id="form">
		<p:growl id="growl" showDetail="true" sticky="true" />  
		<p:panel header="Form" id="panel">
			<h:panelGrid columns="2" cellpadding="10">
				<h:outputText value="Name" />
				
				<p:inputText value="#{testView.info.name}" readonly="#{applicationSocket.readOnly}"></p:inputText>
				
				<h:outputText value="Description" />
				
				<p:inputTextarea value="#{testView.info.description}" readonly="#{applicationSocket.readOnly}"></p:inputTextarea>
				
			</h:panelGrid> 
			
			<p:commandButton value="Edit" 
							widgetVar="edit"
							icon="fa fa-edit" 
							update="@form"
							rendered="#{applicationSocket.readOnly}"
							actionListener="#{testView.editButtonAction()}">
							
			</p:commandButton>
			
			<p:commandButton widgetVar="save" value="Save" icon="fa fa-save" rendered="#{!applicationSocket.readOnly}"></p:commandButton>
			
			<p:commandButton widgetVar="cancel" 
							value="Cancel" 
							rendered="#{!applicationSocket.readOnly}" 
							actionListener="#{testView.cancelButtonAction()}"
							update="@form"
							icon="fa fa-times">
			
			</p:commandButton>
			
        	<p:commandButton actionListener="#{applicationSocket.turnOnEditMode()}" update="@form"></p:commandButton>
		</p:panel>
	
		<o:socket channel="secondChannel"
				onmessage="triggerCommandScript"
			>
			<f:ajax event="updateNotifications" render=":form" listener="#{testView.onEdit()}" />
		</o:socket>
		
		<!-- <o:commandScript name="pushCommandScript" render="panel"></o:commandScript> -->
			<!-- onmessage="function(m){console.log(m);}" --> 
	<p:remoteCommand name="rc" actionListener="#{testView.onEdit()}" update="@form" oncomplete="PF('edit').disable()"></p:remoteCommand>
	
	</h:form>
	<h:form>
	    <o:commandScript name="triggerCommandScript" action="#{testView.onEdit()}" render=":form" />
	</h:form>
	<!-- <o:socket onmessage="asyncListener" channel="async" scope="view" connected="false"></o:socket> -->
	
	<script>
		function onMessage(msg) {
			console.log(msg);
			//alert(msg);
			// rc();
		}
		
		function start() {
			console.log("start");
			OmniFaces.Push.open("async");
		}

		function pushSecondChannel() {
			console.log("second channel");
			OmniFaces.Push.open("secondChannel");
		}

		function asyncListener(result) {
		    OmniFaces.Push.close("async");
		    console.log(result); // Do your thing with HTML DOM.
		    PF("asyncCommand").enable();
		}
	</script>
</h:body>
</html>